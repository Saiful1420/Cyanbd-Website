/*
* show and Hide content
*/

(function ($) {

    $.fn.showHide = function (options) {

 

    //default vars for the plugin

        var defaults = {

            speed: 1000,

            easing: '',

            changeText: 0,

            showText: 'Show',

            hideText: 'Hide'
        };

        var options = $.extend(defaults, options);


        $(this).click(function () {
          var parent = $(this).parents('.slide').attr('id');
            
             
             $('.toggleDiv:hidden').slideUp(options.speed, options.easing);

             // this var stores which button you've clicked

             var toggleClick = $(this);

             // this reads the rel attribute of the button to determine which div id to toggle

             var toggleDiv = $(this).attr('rel');
              if($(toggleDiv).is(":visible")) {
                 $("#"+parent).next('.slide').fadeIn('fast');
             };
             if($(toggleDiv).is(":hidden")){
                $("#"+parent).next('.slide').fadeOut('fast');
             };


             // here we toggle show/hide the correct div at the right speed and using which easing effect

             $(toggleDiv).slideToggle(options.speed, options.easing, function() {

              // this only fires once the animation is completed
             if(options.changeText==1){
             $(toggleDiv).is(":visible") ? toggleClick.text(options.hideText) : toggleClick.text(options.showText);
             
             }


              });
          return false;
        });
    };

})(jQuery);

/*
* get each content height
*/


/*
* 2nd lvl popup
*/
(function($){
    $.fn.bigPopup = function(el){
      $(this).on('click', function(event) {
        event.preventDefault();
        // bigpopup actions
        var bigImg = $(this).children('img').attr('src');
        // create wrapper
        $('body').addClass('body-popup');
        $('<div id="BPwrapper"><span class="BP-close"><a>X</a></span><div id="BPimg"><img src="'+bigImg+'"></div></div>').appendTo('body');
        // self destruct the wrapper
        $('#BPwrapper').click(function() {
          $(this).remove();
          $('body').removeClass('body-popup');
        });
      });
    };
    
})(jQuery);




// do stuff when doc ready

$(document).ready(function(){
    // flexslider
  $('.flexslider').flexslider({
                animation: "fade",
                controlNav: false,
                slideshow:true,
                slideshowSpeed: 2000,          
                animationSpeed: 500
                });

  // nav dropdown
  $('.dashed-nav li.dropdown').hover(function() {
      $(this).addClass('open');
      if ($.browser.msie == true) {
        $(this).children('.dropdown-menu').css({
          top: '40px',
          position: 'fixed'
        });
      };
    }, function() {
      $(this).removeClass('open');
      
  });
  // ie hack
 
  // mobile nav
  if ($(window).width() <= 768) {
    $('.scrollnav').click(function(e){
      $('.navbar-toggle').addClass('collapsed');
      $('.navbar-collapse').css('height', '1px');
    });
  };
  // lazyload
  $("img.lazy, .slide").lazyload();

  // news popup
  $('.news-link').colorbox({iframe:true, innerWidth:960, innerHeight:940});
  $('.map-link').colorbox({iframe:true, innerWidth:960, innerHeight:500});

  // get window height
  var wHeight = $(window).height();
  var pageSpace = '';
  var slider = '';
  var aboutStart = '';
  if ($(window).width() < 1024) {
      pageSpace = wHeight / 2.6; 
      // window width/ aspect ratio
      slider = $(window).width() / 2.6;
      $('#about, #products, #news, #careers, #kitchen, #clients').css('min-height', wHeight);
      var clientschild = $('.client-logo-list .col-md-3').length / 4;
      var clientsHeight = (clientschild * 100) + 100 + pageSpace;    
      var aboutStart = wHeight - 35;
  }else {
      pageSpace = wHeight / 1.5 ;
      slider = 400;
      var clientschild = $('.client-logo-list .col-md-3').length / 4;
      var clientsHeight = (clientschild * 150) + 100 + pageSpace;
      var aboutStart = wHeight - 65;
  };

   // var slideHeight = wHeight + 600;

  // set the content height
  $('#products .content').css('min-height', wHeight);
  // set the slide height
  $('#intro').css('height', aboutStart);
  $('#products').css('height', wHeight+pageSpace);
  // var mainSlide = $('#about, #mteam, #thegroup, #products, #clients, #news, #careers')
 
    if ($.browser.mozilla == true || $.browser.msie == true){
        $('#about ').css({'height':($('#about .content').innerHeight() + pageSpace)});
        $('#thegroup ').css({'height':($('#thegroup .content ').innerHeight() + pageSpace)})
       
    }else {
       $('#about ').css({'height':($('#about .content').innerHeight() + pageSpace + slider)});
       $('#thegroup ').css({'height':($('#thegroup .content ').innerHeight() + pageSpace + slider)})
      
    }
 
  
  $('#mteam').css({'height':($('#mteam .content').innerHeight() + pageSpace)});
  // clients 

  $('#clients').css({'height': clientsHeight });
  $('#printf').css({'height':($('#printf .content').innerHeight() + pageSpace + 200)});
  $('#news').css({'height':($('#news .content').innerHeight() + pageSpace)});
  $('#careers').css({'height':($('#careers .content').innerHeight() + pageSpace)});
  $('#contact').css({'height':($('#contact .content').innerHeight() + pageSpace)});




  // set last slide height
  //$('#contact').css('height', wHeight+300);

  //.parallax(xPosition, adjuster, inertia, outerHeight) options:
  //xPosition - Horizontal position of the element
  //adjuster - y position to start from
  //inertia - speed to move relative to vertical scroll. Example: 0.1 is one tenth the speed of scrolling, 2 is twice the speed of scrolling
  //outerHeight (true/false) - Whether or not jQuery should use it's outerHeight option to determine when a section is in the viewport

  var mteam = $('#about').innerHeight() + pageSpace + slider; 
  var thegroup = mteam + $('#mteam').innerHeight() + pageSpace;
  var printfacility  = thegroup + $('#thegroup').innerHeight() + pageSpace + slider;
  var products = printfacility + $('#printf').innerHeight() + pageSpace + slider;
  var client = products + $('#products').innerHeight() + pageSpace + slider;
  var news = client + clientsHeight + pageSpace;
  var careers = news + $('#news').innerHeight() + pageSpace;
  var contact = careers + $('#careers').innerHeight() + pageSpace;
  console.log(products, printfacility);
  //console.log($('#printf').innerHeight() + pageSpace + slider + $('.print-thumb').height());
  $('#intro').parallax("0", 0, 0, true);

  $('#about').parallax("50%", aboutStart, 0.1, true);
  $('#mteam').parallax("50%", mteam, 0.1, true);

  $('#thegroup').parallax("50%", thegroup, 0.3, true);
  $('#printf').parallax("50%", printfacility, 0.3, true);
  $('#products').parallax("50%", products, 0.3, true);

  $('#clients').parallax("50%", client, 0.3, true);

  $('#news').parallax("50%", news, 0.3, true);

  $('#careers').parallax("50%", careers, 0.3, true);

  $('#contact').parallax("50%", contact, 0.3, true);



  

  var deck = new $.scrolldeck({
    slides: '.slide',
    buttons: '.scrollnav, .navbar-brand',
    easing: 'easeInOutQuint',
    duration: 2000,
    offset: -45
  });


  // init readmore button
  $('.show_hide').showHide({

        speed: 1000,  // speed you want the toggle to happen

        easing: '',  // the animation effect you want. Remove this line if you dont want an effect and if you haven't included jQuery UI

        changeText: 1, // if you dont want the button text to change, set this to 0

        showText: 'Read More>>',// the button text to show when a div is closed

        hideText: 'Close' // the button text to show when a div is open

    });

     //product nav actions
        var loadingData = false;
        $('.parent-link').click(function(event) {
          event.preventDefault();
            if(!loadingData){
            loadingData = true;
            $('#productslide').css('display', 'none');
            $('#product-data').attr('data-source', '').html(''); //empty the wrapper
            var url = $(this).attr('href');
            var productChild = $(this).children('.product-link-wrapper');
            $.ajax({
                url: url,
                type: 'GET',
                dataType: 'json',
            }).done(function(data){
                // console.log('data-loaded');
                loadingData = false;
                $('#product-data').addClass('json-success');
                var catParent = data.parents;
                var cat = data.catagory;
                $('#product-breadcrumb').html('');
                breadcrumb = "<span><strong>"+catParent+"</strong> ><span class='p-cat'> "+cat+"</span></span>";
                breadcrumb += '<div class="select-technics"><ul class="select-filter">';
                $.each(data.child, function(i, chld){
                    breadcrumb += '<li><a href="'+chld.link+'" class="cat-nav">'+chld.pagetitle+'</a></li>';
                });
                breadcrumb +='</ul></div>';
                $(breadcrumb).appendTo('#product-breadcrumb');
                $.each(data.products, function(i, product){
                     content = '<li class="product-thumb '+product.p_type+'" ><a href="#popup-product" data-id="'+product.p_id+'" class="p-details">';
                     content += '<div class="desc-hidden" data-details="'+product.p_details+'" data-detailsthumb="'+product.p_details_small+'">'; 
                     content += '<h3>'+data.parents+' > '+product.p_type+'</h3>';
                     content += '<h3 class="product-title">'+product.p_title+'</h3>';
                     content += product.p_description;
                     content += '</div>';
                        $.each(this.p_image, function() {
                            content += '<img class="img-responsive" src="'+this.thumb[0]+'"></a></li>';
                        });

                    $(content).appendTo('#product-data');
                });
            
                //p-details action
                $('.p-details').click(function(event) {
                  
                  var productKey = $(this).attr('data-id');
                  // var productTitle = $(this).attr('data-title');
                  var productDesc = $(this).children('.desc-hidden').html();
                  var detailsThumb = $(this).children('.desc-hidden').attr('data-detailsthumb');
                  var detailsBig = $(this).children('.desc-hidden').attr('data-details');
                  // var productCatagory = $(this).children('.desc-hidden').attr('data-catagory');
                  $('#popuplist, #popupbig').html('');
                  $.each(data.products[productKey].p_image, function(index, val){
                    var bigImg = this.big;
                    var result = bigImg[index];
                      $("<a href='#' class='img-popup-lg'><img src='"+bigImg[0]+"'></a>").appendTo('#popupbig');
                    $.each(this.thumb, function(index, val){
                      popup = "<li>";
                      popup += '<a class="popup-thumb" href="'+bigImg[index]+'"><img src="'+val+'"></a>';
                      $(popup).appendTo('#popuplist');
                    });
                    $('<li><a class="popup-thumb" href="'+detailsBig+'"><img src="'+detailsThumb+'"></a></li>').appendTo('#popuplist');
                    $('#popupDesc').html('');
                    $(productDesc).appendTo('#popupDesc');
                  });
                });
            });
            }else{
              // alert('still loading, please wait');
            }
        //end product nav
        });


    // form submit actions
   $('#contact-form').ajaxForm(function() { 

            $("#form-message").fadeIn(); //show confirmation message

            $("#contact-form")[0].reset(); 

   }); 
   // product nav actions
   $('#nav-products').click(function(event) {
     /* Act on the event */
     event.preventDefault();
     $('#product-data').attr('data-source', '').html('');
     $('#product-breadcrumb').html('');
     $('#productslide').css('display', 'block');


   });

});

// when ajax complete
$(document).ajaxComplete(function() {
  // remove the product slide
     $('.popup-thumb').click(function(event) {
        $('#productslide').remove();
          event.preventDefault();
        $('#popupbig').html('');
        var biglink = $(this).attr('href');
        $("<a href='#' class='img-popup-lg'><img src='"+biglink+"'></a>").appendTo('#popupbig');
    });
  $('.p-details').colorbox({
    inline:true, 
    width:"820px",
    height:"1600px", 
    initialWidth:"300px", 
    initialHeight:"300px",
    closeButton: false,
    opacity:1,

    onLoad:function(){

      $('.popup-thumb').click(function(event) {
        event.preventDefault();
        $('#popupbig').html('');
        var biglink = $(this).attr('href');
        $("<a href='#' class='img-popup-lg'><img src='"+biglink+"'></a>").appendTo('#popupbig');
         $('.img-popup-lg').bigPopup();
      });
       $('.img-popup-lg').bigPopup();


    }
  });

  
  // filter link

  $('.filter-link').click(function(event){

    event.preventDefault();

    var ListFilter = String($(this).attr('href'));

    $('#product-data li.'+ListFilter).removeClass('not-selected');

    $('#product-data li:not(.'+ListFilter+')').addClass('not-selected');

  });

});


$(document).ajaxSuccess(function(){
   // cat-nav clicked
   var loadingData = false;
  $('.cat-nav').click(function(event){
    event.preventDefault();
    if(!loadingData){

     loadingData = true;
    // empty the product adn breadrcumb catagory
    $('#product-data, .p-cat').html('');
    var url = $(this).attr('href');

    $.ajax({
      url: url,
      type: 'GET',
      dataType: 'json',
      global: false
      
    })
    .done(function(data) {
      loadingData = false;
      $('.p-cat').html(data.catagory);
       $.each(data.products, function(i, product){
                    content = '<li class="product-thumb '+product.p_type+'" ><a href="#popup-product" data-id="'+product.p_id+'" class="p-details">';
                     content += '<div class="desc-hidden" data-details="'+product.p_details+'" data-detailsthumb="'+product.p_details_small+'">'; 
                     content += '<h3>'+data.parents+' > '+product.p_type+'</h3>';
                     content += '<h3 class="product-title">'+product.p_title+'</h3>';
                     content += product.p_description;
                     content += '</div>';
                        $.each(this.p_image, function() {
                            content += '<img class="img-responsive" src="'+this.thumb[0]+'"></a></li>';
                        });

                    $(content).appendTo('#product-data');
                   
    });

      $('.p-details').click(function(event) {
        var productKey = $(this).attr('data-id');
        // var productTitle = $(this).attr('data-title');
        var productDesc = $(this).children('.desc-hidden').html();
         var detailsThumb = $(this).children('.desc-hidden').attr('data-detailsthumb');
         var detailsBig = $(this).children('.desc-hidden').attr('data-details');
        $('#popuplist, #popupbig').html('');
        $.each(data.products[productKey].p_image, function(index, val){
          var desc = this.p_description;
          var bigImg = this.big;

          var result = bigImg[index];

          $("<a href='#' class='img-popup-lg'><img src='"+bigImg[0]+"'></a>").appendTo('#popupbig');

          $.each(this.thumb, function(index, val){
            popup = "<li>";
            popup += '<a class="popup-thumb" href="'+bigImg[index]+'"><img src="'+val+'"></a></li>';
            $(popup).appendTo('#popuplist');
          });
        });
         $('<li><a class="popup-thumb" href="'+detailsBig+'"><img src="'+detailsThumb+'"></a></li>').appendTo('#popuplist');
        $('#popupDesc').html('');
         $(productDesc).appendTo('#popupDesc');
      });

    $('.p-details').colorbox({
        inline:true,
        width:"820px",
        height:"1600px",
        initialWidth:"300px",
        initialHeight:"300px",
        closeButton: false,
        opacity:1,
        onLoad:function(){
          $('.popup-thumb').click(function(event) {
            event.preventDefault();
            $('#popupbig').html('');
            var biglink = $(this).attr('href');
            $("<a href='#' class='img-popup-lg'><img src='"+biglink+"'></a>").appendTo('#popupbig');
             $('.img-popup-lg').bigPopup();
          });
          $('.img-popup-lg').bigPopup();
        }
      });      
    });
    }else{
      // alert("still loading, please wait");
    }
  });
// end cat nav

});
